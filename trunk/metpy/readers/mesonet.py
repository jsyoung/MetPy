#!/usr/bin/env python
from cStringIO import StringIO
from urllib2 import urlopen
import numpy as np
from numpy import ma
from metpy.cbook import loadtxt, mloadtxt #Can go back to numpy once it's updated
from metpy.cbook import (is_string_like, lru_cache, rec_append_fields,
    add_dtype_titles)

__all__ = ['remote_mesonet_data', 'read_mesonet_data', 'mesonet_stid_info']

#This is a direct copy and paste of the mesonet station data avaiable at
#http://www.mesonet.org/sites/geomeso.csv
#As of November 20th, 2008
mesonet_station_table = '''
  100   2008 08 12  GEOMESO.TBL[STNM - Station Number]1 Integer[STID - Station Identifier]1  String[NAME - Station Name]1 String[CITY - Nearest Incorporated Town]1 String[RANG - Range from Town to Station]1 Float[CDIR - Compass Dir. from Town to Station]1 String[CNTY - County]1 String[NLAT - North Latitude]1 Float[ELON - East Longitude]1 Float[ELEV - Elevation in meters]1 Integer[QLOC - Quality of Geog. Location]5 Integer   0 Approximate LATI/LONG and ELEV - No GPS   1 LATI/LONG from GPS; ELEV still approximate   2 ELEV approx. from Topo. map using GPS LATI/LONG   3 Differential GPS to give LATI/LONG and ELEV[CDIV - Oklahoma Climate Division]1 String[CLAS - Station Class]4 String  STANDARD Standard Mesonet Site  OASIS Standard OASIS Site  SUPER Super OASIS Site[SUBC - Station Subclass]2 Integer   0 Mesonet Standard[WCR05 - 5 cm Residual Water Content]1  Float[WCS05 - 5 cm Saturated Water Content]1  Float[A05 - 5 cm Alpha Constant]1  Float[N05 - 5 cm N Constant]1  Float[BULK5 - 5 cm Soil Bulk Density]1  Float[GRAV5 - 5 cm Soil Percentage Gravel]1  Float[SAND5 - 5 cm Soil Percentage Sand]1  Float[SILT5 - 5 cm Soil Percentage Silt]1  Float[CLAY5 - 5 cm Soil Percentage Clay]1  Float[TEXT5 - 5 cm Soil Texture Class]1  String[WCR25 - 25 cm Residual Water Content]1  Float[WCS25 - 25 cm Saturated Water Content]1  Float[A25 - 25 cm Alpha Constant]1  Float[N25 - 25 cm N Constant]1  Float[BULK25 - 25 cm Soil Bulk Density]1  Float[GRAV25 - 25 cm Soil Percentage Gravel]1  Float[SAND25 - 25 cm Soil Percentage Sand]1  Float[SILT25 - 25 cm Soil Percentage Silt]1  Float[CLAY25 - 25 cm Soil Percentage Clay]1  Float[TEXT25 - 25 cm Soil Texture Class]1  String[WCR60 - 60 cm Residual Water Content]1  Float[WCS60 - 60 cm Saturated Water Content]1  Float[A60 - 60 cm Alpha Constant]1  Float[N60 - 60 cm N Constant]1  Float[BULK60 - 60 cm Soil Bulk Density]1  Float[GRAV60 - 60 cm Soil Percentage Gravel]1  Float[SAND60 - 60 cm Soil Percentage Sand]1  Float[SILT60 - 60 cm Soil Percentage Silt]1  Float[CLAY60 - 60 cm Soil Percentage Clay]1  Float[TEXT60 - 60 cm Soil Texture Class]1  String[WCR75 - 75 cm Residual Water Content]1  Float[WCS75 - 75 cm Saturated Water Content]1  Float[A75 - 75 cm Alpha Constant]1  Float[N75 - 75 cm N Constant]1  Float[BULK75 - 75 cm Soil Bulk Density]1  Float[GRAV75 - 75 cm Soil Percentage Gravel]1  Float[SAND75 - 75 cm Soil Percentage Sand]1  Float[SILT75 - 75 cm Soil Percentage Silt]1  Float,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,[CLAY75 - 75 cm Soil Percentage Clay]1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,  Float,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,[TEXT75 - 75 cm Soil Texture Class]1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,  String,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,[DATC - Date Commissioned]1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,, Integer,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,[DATD - Date De-Commissioned]1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,, Integer,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,[STOP]0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,110,ACME,Acme,Rush Springs,4,WNW,Grady,34.80833,-98.02325,397,2,5,ENHANCED,0,0.189,0.519,131.413,1.646,1.13,0,73.43,17.69,8.88,Sandy loam,0.221,0.428,37.376,1.756,1.51,0,52.93,24.93,22.15,Sandy clay loam,0.181,0.411,1384.677,1.215,1.58,0,54.13,25.02,20.85,Sandy clay loam,0.212,0.411,38.497,1.803,1.58,0,56.86,23.62,19.52,Sandy Loam,19940101,209912311,ADAX,Ada,Ada,2,NNE,Pontotoc,34.79851,-96.66909,295,2,8,STANDARD,0,0.188,0.462,272.847,1.463,1.55,3.49,75.29,13.59,11.12,Sandy loam,0.18,0.342,65.528,1.603,1.55,0,55.58,25.23,19.19,Sandy loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,209912312,ALTU,Altus,Altus,3,S,Jackson,34.58722,-99.33808,416,2,7,STANDARD,0,0.233,0.454,37.179,1.343,1.4,0.86,22.65,40.21,37.14,Clay loam,0.267,0.455,14.652,1.729,1.4,0.54,23.58,40.18,36.23,Clay loam,0.246,0.431,25.271,1.389,1.5,0,18.69,55.95,26.36,Silt loam,0.271,0.431,13.179,1.723,1.5,0,20.21,41.08,38.71,Clay loam,19940101,20991231116,ALV2,Alva,Alva,7.2,SSW,Woods,36.70823,-98.70974,439,2,2,ENHANCED,0,0.236,0.455,44.89,1.334,1.4,0,24.21,39.73,36.06,Clay loam,0.237,0.455,78.598,1.216,1.4,0,21.74,34.65,43.62,Clay loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19981217,209912313,ALVA,Alva,Alva,2,S,Woods,36.7797,-98.6717,450,2,2,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,199812164,ANTL,Antlers,Antlers,5,W,Pushmataha,34.22438,-95.70059,179,2,9,STANDARD,0,0.142,0.407,3103.902,1.26,1.6,0,86.27,11.32,2.41,Loamy sand,0.153,0.407,1339.638,1.338,1.6,0,86.12,11.66,2.22,Loamy sand,0.118,0.383,16491.185,1.152,1.7,0,83.04,14.12,2.84,Loamy sand,0.11,0.383,32782.609,1.135,1.7,0,84.8,12.6,2.6,Loamy sand,19940101,20991231111,APAC,Apache,Apache,4,ENE,Caddo,34.91418,-98.29216,440,2,7,STANDARD,0,0.176,0.464,33.705,2.597,1.36,0,84.33,10.62,5.04,Loamy sand,0.162,0.422,1168.364,1.26,1.54,0,70.45,18.2,11.35,Sandy loam,0.159,0.397,257.715,1.168,1.55,0,45.9,36.98,17.12,Loam,0.207,0.389,68.662,1.34,1.68,0,38.94,31.99,29.07,Clay loam,19940101,20991231126,ARD2,Ardmore,Ardmore,3.5,ENE,Carter,34.19258,-97.08568,266,2,8,ENHANCED,0,-999,-999,-999,-999,1.45,0.26,37.51,37.17,25.32,Loam,-999,-999,-999,-999,1.4,0.08,27.27,32.85,39.87,Clay loam,-999,-999,-999,-999,1.35,0.71,20.38,32.68,46.93,Clay,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,20040223,209912315,ARDM,Ardmore,Ardmore,3,ENE,Carter,34.1922,-97.085,266,2,8,ENHANCED,0,0.209,0.44,29.441,1.488,1.45,0,36.77,39.03,24.19,Loam,0.181,0.49,55.583,1.151,1.25,0,20.13,34.81,45.06,Clay,0.228,0.466,25.965,1.23,1.35,0,19.11,35.67,45.23,Clay,0.023,0.466,68.781,1.079,1.35,0.65,19.63,34.82,45.55,Clay,19940101,200402186,ARNE,Arnett,Arnett,8,WSW,Ellis,36.07204,-99.90308,719,2,1,ENHANCED,0,0.188,0.419,25.859,1.785,1.55,0.06,52.43,34.8,12.78,Sandy loam,0.212,0.442,18.226,1.822,1.45,0,40.34,40.85,18.82,Loam,0.188,0.417,44.093,1.397,1.55,0,41.59,37.13,21.28,Loam,0.21,0.416,34.93,1.57,1.55,0,44.48,33.34,22.18,Loam,19940101,209912317,BBOW,Broken Bow,Broken Bow,7,E,McCurtain,34.0144,-94.6131,113,2,9,STANDARD,0,0.046,0.442,74.192,1.159,1.45,2.06,41.66,46.46,11.89,Loam,0.033,0.442,48.599,1.151,1.45,1.76,37.14,49.39,13.47,Loam,0.025,0.43,24.297,1.139,1.55,1.49,27.25,55.6,17.14,Silt loam,0.022,0.431,17.783,1.132,1.5,0.83,24.04,53.79,22.17,Silt loam,19940101,200211198,BEAV,Beaver,Beaver,1,SSW,Beaver,36.80253,-100.53012,758,2,1,ENHANCED,0,0.209,0.442,25.547,1.796,1.45,1.25,45.75,37.58,16.67,Loam,0.246,0.455,16.076,1.803,1.4,0.71,30.14,42.53,27.33,Clay loam,0.182,0.419,4026.084,1.161,1.55,1.12,32.11,42.32,25.57,Loam,0.208,0.417,134.004,1.343,1.55,4.98,40.17,35.4,24.43,Loam,19940101,20991231119,BEEX,Bee,Tishomingo,3.8,SE,Johnston,34.19121,-96.64386,196,2,8,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,20010401,200507139,BESS,Bessie,Bessie,4,WNW,Washita,35.40185,-99.05847,511,2,4,ENHANCED,0,0.169,0.445,11.746,1.608,1.4,16.18,20.52,69.59,9.89,Silt loam,0.157,0.24,24.598,1.556,1.4,,35.12,56.51,8.37,Silt loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123110,BIXB,Bixby,Bixby,2,NE,Tulsa,35.96305,-95.86621,184,2,3,ENHANCED,0,0.17,0.66,126.685,1.717,0.54,0,66.94,29.56,3.5,Sandy loam,0,0.424,1447.533,1.099,1.45,0,51.97,38.49,9.54,Loam,0.18,0.386,11.851,1.97,1.69,0,41.14,49.52,9.34,Loam,0.222,0.513,13.893,1.783,1.16,0,58.92,35.44,5.64,Sandy loam,19940101,2099123111,BLAC,Blackwell,Blackwell,4,SSE,Kay,36.75443,-97.25452,304,2,2,ENHANCED,0,0,0.46,98.006,1.129,1.4,0,34.91,53.99,11.09,Silt loam,0.239,0.449,11.723,1.683,1.41,0,24.57,47.96,27.47,Clay loam,0.207,0.397,25.413,1.366,1.63,0,27.35,40.59,32.06,Clay loam,0.189,0.394,34.301,1.295,1.64,0,28.58,40.54,30.87,Clay loam,19940101,2099123112,BOIS,Boise City,Boise City,3,SSE,Cimarron,36.69256,-102.49713,1267,2,1,ENHANCED,0,0.219,0.455,138.507,1.234,1.4,0,36.16,27.87,35.96,Clay loam,0.13,0.455,171.663,1.117,1.4,0,31.61,30.45,37.94,Clay loam,0.206,0.443,12.85,1.285,1.45,0,16.43,43.83,39.74,Silty clay loam,0.198,0.443,12.989,1.288,1.45,0.52,14.88,47.3,37.82,Silty clay loam,19940101,2099123113,BOWL,Bowlegs,Bowlegs,3,NE,Seminole,35.17156,-96.63121,281,2,5,STANDARD,0,0.18,0.418,51.011,1.534,1.55,0,58.28,29.56,12.16,Sandy loam,0.201,0.418,51.368,1.532,1.44,0,52.49,28.61,18.9,Sandy loam,0.206,0.431,195.526,1.249,1.6,0,42.39,27.08,30.53,Clay loam,0.211,0.431,116.793,1.314,1.62,0,43.15,26.71,30.14,Clay loam,19940101,2099123114,BREC,Breckinridge,Breckinridge,3,SE,Garfield,36.41201,-97.69394,352,2,2,ENHANCED,0,0.148,0.457,90.267,1.248,1.4,0.03,21.78,61.04,17.18,Silt loam,0.268,0.438,6.008,1.846,1.35,0,11.11,49.92,38.97,Silty clay loam,0.211,0.397,10.37,1.338,1.4,0,12.27,45.93,41.8,Silty clay,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123115,BRIS,Bristow,Bristow,4,SE,Creek,35.7805,-96.35404,239,2,5,STANDARD,0,0.163,0.418,68.043,1.612,1.55,0.48,68.95,27.15,3.9,Sandy loam,0.178,0.419,41.487,1.654,1.55,0.55,61.79,29.3,8.91,Sandy loam,0.142,0.419,66.595,1.272,1.55,0,47.19,37.17,15.64,Loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,20991231124,BROK,Broken Bow,Broken Bow,6.5,E,McCurtain,34.0433,-94.6244,113,2,9,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,20030404,2099123116,BUFF,Buffalo,Buffalo,0.5,SW,Harper,36.83129,-99.64101,559,2,1,STANDARD,0,0.191,0.443,20.017,1.871,1.45,0,40.98,45.64,13.38,Loam,0.218,0.455,10.392,2.032,1.4,0,26.7,53.45,19.86,Silt loam,0.235,0.431,11.563,1.797,1.5,0,26.12,46.19,27.69,Clay loam,0.245,0.431,11.564,1.762,1.5,0.67,24.43,44.42,31.14,Clay loam,19940101,2099123117,BURB,Burbank,Burbank,7,SW,Osage,36.63459,-96.81046,301,2,3,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123118,BURN,Burneyville,Burneyville,2,SE,Love,33.89376,-97.26918,228,2,8,ENHANCED,0,0.165,0.399,95.35,1.782,1.6,0,79.33,16.76,3.9,Loamy sand,0.171,0.412,76.916,1.809,1.55,0,75.23,18.48,6.29,Sandy loam,0.167,0.378,60.599,1.852,1.7,0,78.34,15.85,5.8,Loamy sand,0.166,0.376,76.211,1.881,1.7,0,82.88,12.12,5,Loamy sand,19940101,2099123119,BUTL,Butler,Butler,5,SW,Custer,35.5915,-99.27059,520,2,4,ENHANCED,0,0.165,0.445,79.614,1.217,1.4,0.03,20.31,54.55,25.14,Silt loam,0.221,0.467,11.344,1.399,1.35,0.07,15.96,54.61,29.43,Silty clay loam,0.215,0.443,7.245,1.326,1.45,0.19,10.63,53.43,35.93,Silty clay loam,0.191,0.443,19.555,1.278,1.45,0.09,16.61,51.75,31.64,Silty clay loam,19940101,2099123120,BYAR,Byars,Byars,3,ESE,Garvin,34.8497,-97.0033,345,2,8,ENHANCED,0,0.167,0.445,134.245,1.766,1.4,0,82.79,13.65,3.56,Loamy sand,0.185,0.347,285.978,1.31,1.84,0,56.7,21.1,22.2,Sandy clay loam,0.182,0.373,2826.528,1.198,1.74,0.02,61.64,13.74,24.62,Sandy clay loam,0.187,0.309,7313.215,1.241,1.99,0,63.88,11.52,24.6,Sandy clay loam,19940101,2099123121,CALV,Calvin,Calvin,5,WNW,Hughes,34.9924,-96.33422,234,2,6,STANDARD,0,0.178,0.459,20.657,1.962,1.55,0,52.5,40.75,6.74,Sandy loam,0.172,0.392,24.244,1.773,1.45,0,51.31,40.37,8.32,Loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123122,CAMA,Camargo,Camargo,4,WNW,Dewey,36.02866,-99.34652,589,2,4,ENHANCED,0,0.177,0.441,21.78,1.87,1.45,0,44.76,47.04,8.19,Loam,0.172,0.419,20.127,1.875,1.55,1.22,51.28,42.13,6.59,Sandy loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,20991231131,CARL,Lake Carl Blackwell,Orlando,5,E,Payne,36.1473,-97.28585,293,2,5,STANDARD,1,-999,-999,-999,-999,-999,-999,34.4,49.72,15.88,Loam,-999,-999,-999,-999,-999,-999,26.37,39.75,33.88,Clay Loam,-999,-999,-999,-999,-999,-999,22.84,36.57,40.59,Clay,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,20080301,20991231112,CATO,Catoosa,Catoosa,4.7,NNW,Rogers,36.2619,-95.7572,232,2,3,STANDARD,0,0.226,0.467,11.827,1.488,1,0.09,18.31,53.42,28.27,Silty clay loam,0.18,0.467,33.982,1.213,1.38,0.22,18.07,47.02,34.91,Silty clay loam,0.243,0.466,37.712,1.18,1.38,1.53,13.84,32.63,53.53,Clay,-999,-999,-999,-999,-999,-999,-999,-999,-999,Rock,19960618,2001041823,CENT,Centrahoma,Centrahoma,1,E,Coal,34.60896,-96.33309,208,2,8,ENHANCED,0,0.181,0.419,31.996,1.706,1.55,0.11,59.09,31.64,9.27,Sandy loam,0.151,0.443,452.779,1.213,1.45,0.11,47.9,36.48,15.62,Loam,0.184,0.431,377.203,1.162,1.5,0.06,35.16,31.41,33.43,Clay loam,0.192,0.431,86.417,1.249,1.5,0.46,36.6,32.36,31.04,Clay loam,19940101,2099123124,CHAN,Chandler,Sparks,3,NNE,Lincoln,35.65282,-96.80407,291,2,5,ENHANCED,0,0.234,0.562,764.274,1.352,0.95,0,64.78,12.3,22.93,Sandy clay loam,0.192,0.373,323.736,1.089,1.74,0,27.26,17.99,54.75,Clay,0.164,0.435,178.366,1.103,1.48,0,30.08,23.77,46.14,Clay,0.226,0.409,1064.987,1.132,1.59,0,35.21,17.07,47.72,Clay,19940101,2099123125,CHER,Cherokee,Cherokee,0.5,SSW,Alfalfa,36.74813,-98.36274,362,2,2,ENHANCED,0,0.186,0.443,16.449,1.891,1.45,1.18,42.41,45.27,12.32,Loam,0.148,0.443,1293.875,1.209,1.45,0.36,38.63,48.75,12.63,Loam,0.183,0.419,25.094,1.757,1.55,0.88,44.77,43.14,12.09,Loam,0.181,0.419,16.856,1.8,1.55,0.8,43.33,45.02,11.65,Loam,19940101,2099123126,CHEY,Cheyenne,Cheyenne,6,SW,Roger Mills,35.54615,-99.7279,694,2,4,ENHANCED,0,0.201,0.419,38.474,1.643,1.55,0,53.16,29.66,17.18,Sandy loam,0.191,0.419,30.91,1.785,1.55,0,57.62,29.9,12.49,Sandy loam,0.169,0.419,88.71,1.224,1.55,0,37.18,39,23.83,Loam,0.192,0.419,55.93,1.312,1.5,0,36.71,36.96,26.32,Loam,19940101,2099123127,CHIC,Chickasha,Chickasha,2,SSE,Grady,35.03236,-97.91446,328,2,5,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123128,CLAR,Claremore,Claremore,1,WNW,Rogers,36.3172,-95.6417,213,2,3,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2002070729,CLAY,Clayton,Clayton,3,NNE,Pushmataha,34.65657,-95.32596,186,2,9,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123130,CLOU,Cloudy,Cloudy,5,SSE,Pushmataha,34.22321,-95.2487,221,2,9,ENHANCED,0,0.141,0.447,21.917,1.528,1.4,10.81,39.07,57.15,3.78,Silt loam,0.171,0.452,20.902,1.461,1.4,5.75,32.61,52.15,15.24,Silt loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,20991231122,CLRM,Claremore,Claremore,1.8,WNW,Rogers,36.32112,-95.64617,207,2,3,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,20020711,2099123131,COOK,Cookson,Marble City,7,NNW,Cherokee,35.68001,-94.84896,299,2,6,ENHANCED,0,0,0.44,11.974,1.255,1.4,16.37,24.72,69.1,6.18,Silt loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123132,COPA,Copan,Copan,2,ENE,Washington,36.90987,-95.88553,250,2,3,ENHANCED,0,0.175,0.51,47.692,1.464,1.45,0.37,49.71,37.45,12.84,Loam,0.158,0.435,168.613,1.225,1.45,3.09,44.4,34.09,21.51,Loam,-999,-999,-999,-999,1.65,0,66.69,24.77,8.54,Sandy loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123133,DURA,Durant,Durant,6,SSE,Bryan,33.92075,-96.32027,197,2,8,ENHANCED,0,0.189,0.418,46.07,1.564,1.55,0.55,55.04,29.94,15.02,Sandy loam,0.177,0.455,729.18,1.174,1.4,0.19,44.28,28.5,27.22,Sandy clay loam,0.263,0.467,46.929,1.303,1.35,0.12,25.78,30.52,43.7,Clay,0.251,0.467,100.797,1.225,1.35,0.15,29.19,25.71,45.1,Clay,19940101,2099123134,ELRE,El Reno,El Reno,5,WNW,Canadian,35.54848,-98.03654,419,2,5,ENHANCED,0,0.224,0.535,12.847,1.878,1.06,0,25.35,59.65,15,Silt loam,0,0.493,118.331,1.127,1.24,0,21.11,59.12,19.77,Silt loam,0.23,0.425,8.208,1.763,1.53,0,19.73,51.67,28.6,Silty clay loam,0.182,0.39,21.185,1.283,1.67,0,17.7,49.33,32.97,Silty clay loam,19940101,2099123135,ERIC,Erick,Erick,4,ESE,Beckham,35.20494,-99.80344,603,2,4,STANDARD,0,0.176,0.407,47.527,2.139,1.6,0,80.68,12.33,6.98,Loamy sand,0.177,0.406,52.604,2.055,1.6,0,80.94,11.54,7.53,Loamy sand,0.18,0.395,50.492,1.781,1.65,0,71.66,18.67,9.68,Sandy loam,0.191,0.395,31.379,1.861,1.65,0,60.83,25.48,13.69,Sandy loam,19940101,2099123136,EUFA,Eufaula,Eufaula,4,WNW,McIntosh,35.30324,-95.65707,200,2,6,STANDARD,0,0.178,0.443,13.689,2.054,1.45,0.41,44.03,48.66,7.31,Loam,0.234,0.442,10.314,2.082,1.45,0,32.3,40.71,26.98,Loam,0.24,0.467,29.25,1.328,1.5,0,28.07,40.16,31.77,Clay loam,0,0.455,3.039,1.18,1.5,0,28.02,41.65,30.34,Clay loam,19940101,2099123137,FAIR,Fairview,Fairview,1,W,Major,36.26353,-98.49766,405,2,2,STANDARD,0,0,0.455,354.067,1.11,1.23,0,30.08,54.04,15.88,Silt loam,0.229,0.455,9.707,1.895,1.41,0,24.88,53.24,21.89,Silt loam,0.246,0.431,14.503,1.598,1.7,0,22.17,44.42,33.41,Clay loam,0.163,0.443,38.142,1.179,1.7,0,18.81,44.1,37.09,Silty clay loam,19940101,20991231127,FITT,Fittstown,Fittstown,6.3,SW,Pontotoc,34.55205,-96.71779,350,2,8,STANDARD,0,-999,-999,-999,-999,1.55,0,60.81,27.41,11.78,Sandy loam,-999,-999,-999,-999,1.55,0,61.34,20.62,18.04,Sandy loam,-999,-999,-999,-999,1.5,0,54.26,17.71,28.04,Sandy clay loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,20050512,2099123138,FORA,Foraker,Foraker,8,ESE,Osage,36.84053,-96.42777,330,2,3,ENHANCED,0,0.194,0.419,42.915,1.594,1.55,0.09,56.09,28.99,14.92,Sandy loam,0.202,0.419,60.114,1.542,1.55,0.19,56.68,24.82,18.5,Sandy loam,0.223,0.429,38.309,1.709,1.65,5.68,58.08,22.52,19.4,Sandy loam,0.193,0.428,616.921,1.28,1.5,3.84,56.52,22.49,20.99,Sandy clay loam,19940101,2099123139,FREE,Freedom,Freedom,3,SSW,Woodward,36.72562,-99.14234,530,2,2,ENHANCED,0,0,0.455,159.885,1.131,1.4,0,24.73,61.36,13.91,Silt loam,0,0.455,127.882,1.129,1.4,0,25.3,58.82,15.88,Silt loam,-999,-999,-999,-999,-999,0,27.25,61.26,11.48,Silt loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123140,FTCB,Fort Cobb,Fort Cobb,4,NNW,Caddo,35.14887,-98.46607,422,2,7,ENHANCED,0,0.199,0.554,122.466,1.873,0.99,0.05,80.02,9.47,10.51,Loamy sand,0.197,0.376,591.041,1.434,1.73,0,73.24,6.41,20.36,Sandy clay loam,0.191,0.426,33.517,2.545,1.52,0,82.3,5.7,12,Loamy sand,0.179,0.419,54.178,2.321,1.55,0,87.96,3.74,8.3,Loamy sand,19940101,2099123141,GOOD,Goodwell,Goodwell,2,E,Texas,36.60183,-101.6013,997,2,1,ENHANCED,0,0.21,0.441,48.048,1.426,1.45,0,40.59,36.86,22.55,Loam,0.212,0.443,47.06,1.372,1.45,0.01,38.65,35.43,25.92,Loam,0.199,0.431,49.771,1.279,1.5,0.5,29.19,40.98,29.82,Clay loam,0.206,0.431,498.65,1.17,1.5,1.69,38.18,25.02,36.81,Clay loam,19940101,20991231117,GRA2,Grandfield,Grandfield,3.3,W,Tillman,34.2392,-98.7444,341,2,7,ENHANCED,0,0.233,0.455,12.079,1.584,1.4,0.26,21.92,46.24,31.84,Clay loam,0,0.467,79.299,1.09,1.35,1.33,19.21,43.83,36.96,Silty clay loam,-999,-999,-999,-999,1.5,0,20.91,42.6,36.48,Clay loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19990401,2099123142,GRAN,Grandfield,Grandfield,3,WNW,Tillman,34.2392,-98.7397,342,2,7,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,1999031643,GUTH,Guthrie,Guthrie,4,WSW,Logan,35.84891,-97.47978,330,2,5,ENHANCED,0,0.193,0.453,642.443,1.319,1.55,3.79,55.33,26.31,18.37,Sandy loam,0.158,0.364,364.04,1.158,1.45,0.04,30.71,42.56,26.74,Loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123144,HASK,Haskell,Haskell,5,SSE,Muskogee,35.74798,-95.64047,183,2,6,STANDARD,0,0.178,0.454,6.983,1.678,1.01,0,18.11,67.12,14.77,Silt loam,0.152,0.455,19.741,1.391,1.4,0,21.47,67.71,10.82,Silt loam,0.253,0.443,6.954,1.685,1.5,0,20.83,66.12,13.06,Silt loam,0.281,0.455,7.424,1.771,1.67,0,12.77,45.68,41.55,Silty clay,19940101,20991231113,HECT,Hectorville,Hectorville,4.1,W,Okmulgee,35.84162,-96.0024,243,2,6,STANDARD,0,0.024,0.442,520.328,1.127,1.45,0,46.54,43.79,9.68,Loam,0.143,0.408,193.18,1.312,1.55,0,70.43,18.23,11.34,Sandy loam,0.181,0.389,99.877,1.621,1.65,0,56.16,29.15,14.69,Sandy loam,0.226,0.43,382.277,1.17,1.88,1.27,33.7,26.46,39.84,Clay loam,19960618,2099123145,HINT,Hinton,Hinton,7,W,Caddo,35.48439,-98.48151,493,2,7,ENHANCED,0,0.178,0.462,34.267,2.177,1.36,0,75.99,17.73,6.27,Sandy loam,0.175,0.408,30.834,2.651,1.6,0,87.17,6.01,6.82,Loamy sand,0.178,0.447,30.412,2.658,1.43,0,85.95,7.21,6.84,Loamy sand,0.179,0.442,27.414,2.547,1.45,0,79.17,13.79,7.04,Loamy sand,19940101,2099123146,HOBA,Hobart,Hobart,4,SE,Kiowa,34.98971,-99.05283,478,2,7,ENHANCED,0,0,0.467,7.723,2.022,1.35,0,18.34,54.46,27.2,Silty clay loam,0.237,0.479,8.416,1.282,1.3,0,10.06,45.51,44.43,Silty clay,0.195,0.455,83.3,1.641,1.4,0.1,16.37,40.7,42.93,Silty clay,0.175,0.455,46.705,1.175,1.4,1.66,15.72,41.97,42.31,Silty clay,19940101,2099123147,HOLL,Hollis,Gould,3,W,Harmon,34.6855,-99.83331,497,2,7,ENHANCED,0,0,0.478,219.279,1.076,1.3,1.26,18.91,40.95,40.15,Silty clay,0.207,0.49,123.181,1.146,1.25,1.83,20.57,32.56,46.87,Clay,0.196,0.454,15.38,1.19,1.4,2.01,11.08,40.68,48.24,Silty clay,0.006,0.464,181.149,1.057,1.35,3.56,18.63,34.97,46.4,Clay,19940101,2099123148,HOOK,Hooker,Hooker,1,W,Texas,36.85518,-101.22547,912,2,1,STANDARD,0,0.202,0.443,20.973,1.742,1.45,0,43.18,43.33,13.49,loam,0.196,0.443,48.54,1.422,1.45,0,43.54,36.54,19.92,Loam,-999,-999,-999,-999,1.55,0,40.41,38.01,21.58,Loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123149,HUGO,Hugo,Hugo,2,NW,Choctaw,34.03084,-95.54011,175,2,9,ENHANCED,0,0.179,0.442,17.74,1.792,1.45,2.84,43.2,48.59,8.21,Loam,0.125,0.441,197.674,1.18,1.45,3.45,31.3,43.97,24.73,Loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123150,IDAB,Idabel,Idabel,5,SW,McCurtain,33.83013,-94.8803,110,2,9,ENHANCED,0,0.2,0.455,4.225,1.758,1.4,0,10.65,68.99,20.37,Silt loam,0.228,0.467,6.676,1.38,1.35,0,7.66,52.66,39.68,Silty clay loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,20991231120,INOL,Inola,Inola,3.1,SSE,Rogers,36.14246,-95.45067,190,2,3,STANDARD,0,-999,-999,-999,-999,1.45,0,39.84,42.23,17.93,Loam,-999,-999,-999,-999,1.4,0,38.72,34.07,27.21,Clay loam,-999,-999,-999,-999,1.35,0,11.51,24.66,63.82,Clay,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,20011201,2099123151,JAYX,Jay,Jay,4,N,Delaware,36.4821,-94.78287,304,2,3,ENHANCED,0,0.164,0.455,6.017,1.591,1.4,0.05,16.38,72.46,11.16,Silt loam,0.135,0.454,5.935,1.432,1.4,2.2,14.1,69.74,16.16,Silt loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123152,KENT,Kenton,Kenton,5,SE,Cimarron,36.82937,-102.8782,1322,2,1,ENHANCED,0,0.105,0.436,1489.671,1.139,1.45,7.63,42.73,41.57,15.7,Loam,0.168,0.436,1337.706,1.151,1.45,8.74,30.54,43.57,25.89,Loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123153,KETC,Ketchum Ranch,Velma,7,NW,Stephens,34.52887,-97.76484,341,2,8,ENHANCED,0,0,0.576,1034.369,1.115,0.89,1.31,46.08,37.51,16.41,Loam,0.191,0.415,75.84,1.237,1.57,0.86,33.01,33.83,33.15,Clay loam,0.193,0.416,417.889,1.141,1.56,0.65,27.8,30.02,42.18,Clay,0.223,0.392,850.116,1.195,1.66,0,36.96,23.75,39.29,Clay loam,19940101,2099123154,KING,Kingfisher,Kingfisher,2,NE,Kingfisher,35.8805,-97.91121,319,2,5,STANDARD,0,0.192,0.511,18.481,1.926,1.16,0.26,45.46,45.17,9.37,Loam,0,0.469,420.103,1.118,1.4,0.08,39.24,50.12,10.64,Silt loam,0.22,0.425,14.691,1.801,1.5,0.01,25.85,52.58,21.56,Silt loam,0.225,0.403,9.025,2.029,1.61,0,28.23,47.18,24.59,Loam,19940101,2099123155,LAHO,Lahoma,Lahoma,1,WSW,Major,36.38435,-98.11139,396,2,2,ENHANCED,0,0,0.464,387.322,1.11,1.36,0,26.73,55.26,18.01,Silt loam,0.242,0.424,7.858,1.985,1.53,0,20.91,50.09,29,Clay loam,0.166,0.386,31.183,1.227,1.69,0,19.51,49.3,31.19,Silty clay loam,0.134,0.412,8.867,1.233,1.58,0,13.42,55.5,31.07,Silty clay loam,19940101,2099123156,LANE,Lane,Lane,1,WNW,Atoka,34.30876,-95.99716,181,2,8,ENHANCED,0,0.158,0.419,47.399,1.555,1.55,0.13,58.26,37.92,3.82,Sandy loam,0.163,0.419,26.217,1.575,1.55,0.43,51.11,42.58,6.31,Sandy loam,0.157,0.393,30.101,1.514,1.65,2.56,52.46,41.72,5.82,Sandy loam,0.176,0.419,29.672,1.514,1.55,0.6,47.44,40.7,11.87,Loam,19940101,2099123157,MADI,Madill,Lebanon,4.5,NNW,Marshall,34.03579,-96.94394,232,2,8,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123158,MANG,Mangum,Mangum,5,SE,Greer,34.83592,-99.42398,460,2,7,ENHANCED,0,0.162,0.406,48.471,3.563,1.6,0,96.64,1.57,1.8,Sand,0.168,0.406,41.177,3.767,1.6,0,93.78,1.78,4.43,Sand,0.189,0.431,3527.601,1.215,1.5,0.02,64.71,14.29,20.99,Sandy clay loam,0.247,0.467,79.726,1.277,1.35,0.03,33.06,26.49,40.45,Clay,19940101,2099123159,MARE,Marena,Coyle,7,N,Payne,36.06434,-97.21271,327,2,5,ENHANCED,0,0.217,0.435,48.2,1.604,1.48,0,53.86,25.68,20.46,Sandy clay loam,0.222,0.449,25.893,1.819,1.42,0,48.43,31.19,20.38,Loam,0.229,0.405,32.879,1.667,1.6,0,45.77,25.26,28.97,Sandy clay loam,0.218,0.38,45.967,1.641,1.71,0,50.36,21.29,28.35,Sandy clay loam,19940101,2099123160,MARS,Marshall,Marshall,3,SSE,Logan,36.1186,-97.6014,315,2,5,STANDARD,0,0.217,0.438,9.689,1.848,1.47,0,23.91,54.71,21.38,Silt loam,0.22,0.463,13.572,1.328,1.3,0,9.44,47.41,43.15,Silty clay,0.202,0.422,11.12,1.304,1.54,0,14.04,42.63,43.32,Silty clay,0.172,0.381,59.897,1.184,1.71,3.09,19.26,42.83,37.91,Silty clay loam,19940101,2003092361,MAYR,May Ranch,Freedom,16,NNE,Woods,36.98707,-99.01109,555,2,2,ENHANCED,0,0.195,0.419,25.861,1.774,1.55,0,53.67,31.99,14.34,Sandy loam,0.233,0.443,19.91,1.877,1.45,0,42.08,33.92,23.99,Loam,0.207,0.431,28.542,1.247,1.5,0,20,40.54,39.47,Clay loam - Silty clay loam,0.207,0.431,21.332,1.282,1.5,0,21.63,40.63,37.73,Clay loam,19940101,2099123162,MCAL,McAlester,McAlester,4,S,Pittsburg,34.88231,-95.78096,230,2,6,STANDARD,0,0.155,0.407,90.776,1.592,1.6,0.12,77.48,19.83,2.68,Loamy sand,0.237,0.455,60.887,1.529,1.4,0.05,46.19,24.24,29.56,Sandy clay loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123163,MEDF,Medford,Medford,1,SW,Grant,36.79242,-97.74577,332,2,2,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123164,MEDI,Medicine Park,Medicine Park,3,W,Comanche,34.72921,-98.56936,487,2,7,ENHANCED,0,0.127,0.415,130.341,1.248,1.55,9.75,66.57,27.25,6.18,Sandy loam,0.157,0.24,24.598,1.556,1.55,21.98,71.49,18.68,9.84,Sandy loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123165,MIAM,Miami,Miami,2,NE,Ottawa,36.88832,-94.84437,247,2,3,ENHANCED,0,0.14,0.531,13.635,1.51,1.08,0.2,27.48,63.57,8.95,Silt loam,0,0.454,13.01,1.24,1.4,1.43,25.5,65.63,8.86,Silt loam,0.192,0.459,18.968,1.188,1.35,0,19.42,38.25,42.33,Clay,0.061,0.428,13.273,1.129,1.51,0.14,14.32,43.39,42.3,Silty clay,19940101,2099123166,MINC,Minco,Minco,2,SSW,Grady,35.27225,-97.95553,430,2,5,ENHANCED,0,0.208,0.453,8.71,1.902,1.4,1.54,23.97,59.15,16.89,Silt loam,0.199,0.455,7.73,1.78,1.4,0,19.97,66.77,13.24,Silt loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,20991231125,MRSH,Marshall,Marshall,4,SSE,Logan,36.11685,-97.60685,311,2,5,STANDARD,0,-999,-999,-999,-999,1.4,0,25.42,57.49,17.09,Silt loam,-999,-999,-999,-999,1.35,0.05,19.36,40.72,39.92,Silty clay loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,20030925,2099123167,MTHE,Mt Herman,Smithville,16,SW,McCurtain,34.31072,-94.82275,285,2,9,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123168,NEWK,Newkirk,Newkirk,8,E,Kay,36.8981,-96.91035,366,2,2,ENHANCED,0,0.232,0.558,11.289,1.956,1.4,0,22.53,61.36,16.12,Silt loam,0.196,0.462,22.702,1.413,1.4,0.01,22.2,55.89,21.99,Silt loam,0.236,0.414,7.164,1.749,1.45,0,17.89,42.28,33.83,Silty clay loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,20991231123,NEWP,Newport,Ardmore,7,WNW,Carter,34.2281,-97.20142,283,2,8,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,20021003,20991231109,NINN,Ninnekah,Ninnekah,2,NNW,Grady,34.96774,-97.95202,356,2,5,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123169,NORM,Norman,Norman,3,NW,Cleveland,35.2556,-97.4836,360,2,5,SUPER,0,0,0.48,56.59,1.133,1.29,0,19.06,56.62,24.32,Silt loam,0.213,0.421,12.533,1.311,1.35,0,13.3,47.55,39.15,Silty clay loam,0.205,0.412,16.542,1.3,1.5,2.04,22.23,40.15,37.62,Clay loam,0.213,0.391,15.094,1.347,1.67,2.6,16.45,41.32,42.23,Silty clay,19940101,2002073070,NOWA,Nowata,Delaware,3,SE,Nowata,36.74374,-95.60795,206,2,3,STANDARD,0,0.126,0.457,14.805,1.349,1.39,0.99,27.32,59.35,13.33,Silt loam,0.149,0.463,16.668,1.379,1.36,0,28.62,57.82,13.56,Silt loam,0.187,0.419,26.313,1.218,1.55,0.78,19.94,40.61,39.45,Silty clay loam,0.236,0.391,13.26,1.362,1.67,0.17,17.54,38.95,43.5,Clay,19940101,20991231121,NRMN,Norman,Norman,2.1,NW,Cleveland,35.23611,-97.46488,357,2,5,SUPER,0,0,0.48,56.59,1.133,1.4,0,22.25,61.56,16.19,Silt loam,0.213,0.421,12.533,1.311,1.35,0,18.63,41.87,39.5,Silty clay loam,0.205,0.412,16.542,1.3,1.35,0.62,18.83,39.62,41.55,Clay,0.213,0.391,15.094,1.347,1.35,2.14,21.1,36.25,42.65,Clay,20020701,2099123171,OILT,Oilton,Oilton,6,ESE,Creek,36.03126,-96.49749,255,2,5,ENHANCED,0,0.188,0.455,56.132,1.57,1.55,0,62.12,24.8,13.07,Sandy loam,0.164,0.374,13.581,1.296,1.4,0,23.11,50.17,26.73,Silt loam,0.143,0.409,934.606,1.181,1.55,0.03,51.79,32.39,15.82,Loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,20991231130,OKCE,Oklahoma City East,Oklahoma City,3,E,Oklahoma,35.47226,-97.46414,355,2,5,ENHANCED,0,-999,-999,-999,-999,1.55,0,66.15,19.06,14.79,Sandy Loam,-999,-999,-999,-999,1.6,1,78.63,11.98,9.39,Loamy Sand,-999,-999,-999,-999,1.7,4,79.4,13.2,7.39,Loamy Sand,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,20070420,20991231128,OKCN,Oklahoma City North,Oklahoma City,6.1,N,Oklahoma,35.5556,-97.5107,362,2,5,ENHANCED,0,-999,-999,-999,-999,-999,0,18.25,48.72,33.03,Silt,-999,-999,-999,-999,1.25,0,12.32,38.75,48.93,Clay,-999,-999,-999,-999,1.4,0,13.41,44.16,42.42,Silty Clay,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,20070303,20991231129,OKCW,Oklahoma City West,Oklahoma City,3.7,W,Oklahoma,35.47112,-97.58245,366,2,5,ENHANCED,0,-999,-999,-999,-999,1.4,0,29.91,36.14,33.94,Clay Loam,-999,-999,-999,-999,1.3,0,17.65,41.22,41.13,Silty Clay,-999,-999,-999,-999,1.5,0,21.77,49.83,28.39,Clay Loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,20070406,2099123172,OKEM,Okemah,Okemah,3,E,Okfuskee,35.43172,-96.26265,263,2,5,ENHANCED,0,0.196,0.468,13.267,2.133,1.4,1.18,23.76,58.9,17.35,Silt loam,0.15,0.445,462.37,1.185,1.45,0,39.27,45.46,15.27,Loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123173,OKMU,Okmulgee,Morris,3,SW,Okmulgee,35.58211,-95.91473,205,2,6,ENHANCED,0,0.185,0.441,13.781,1.926,1.45,0,41.43,46.39,12.18,Loam,0.188,0.451,11.29,1.701,1.4,6.22,25.5,59.74,14.76,Silt loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123174,PAUL,Pauls Valley,Pauls Valley,1,SSW,Garvin,34.7155,-97.22924,291,2,8,ENHANCED,0,0.196,0.529,12.318,1.996,1.4,0,31.4,58.8,9.8,Silt loam,0.208,0.472,10.279,1.816,1.4,0,26.07,58.05,15.89,Silt loam,0.196,0.445,10.589,1.551,1.5,0,21.94,55.44,22.62,Silt loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123175,PAWN,Pawnee,Pawnee,3,ENE,Pawnee,36.36114,-96.76986,283,2,3,ENHANCED,0,0.147,0.467,69.942,1.159,1.35,0.01,16.77,49.41,33.82,Silty clay loam,0.184,0.464,41.754,1.188,1.35,1.99,15.26,45.6,39.15,Silty clay loam,0,0.428,95.936,1.091,1.5,10.18,30.05,40.97,28.97,Clay loam,0,0.442,34.878,1.087,1.45,4.48,19.68,42.8,37.52,Silty clay loam,19940101,2099123176,PERK,Perkins,Perkins,2,NNW,Payne,35.99865,-97.04831,292,2,5,STANDARD,0,0.19,0.452,30.602,1.767,1.45,0,51.88,35.84,12.28,Loam,0.191,0.438,28.672,1.701,1.45,0,49.82,35.96,14.22,Loam,0.196,0.422,74.67,1.303,1.54,0.01,37.91,35.93,26.16,Loam,0.177,0.405,125.457,1.29,1.61,0,48.11,30.54,21.35,Loam,19940101,20991231118,PORT,Porter,Clarksville,2.5,W,Wagoner,35.8257,-95.55976,193,2,3,ENHANCED,0,0.164,0.417,62.253,1.508,1.55,0,62.73,31.17,6.1,Sandy loam,0.179,0.418,57.974,1.538,1.55,0,59.09,29.23,11.69,Sandy loam,0.181,0.394,80.581,1.44,1.65,0,58.22,26.42,15.36,Sandy loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19991105,20991231114,PRES,Preston,Preston,1,N,Okmulgee,35.7247,-95.9886,300,2,6,STANDARD,0,0.19,0.418,30.602,1.767,1.55,2.17,66.02,26.99,6.98,Sandy loam,0.194,0.418,29.572,1.914,1.55,2.69,60.37,26.32,13.31,Sandy loam,0.184,0.391,74.609,1.704,1.65,7.41,72.11,16.3,11.59,Sandy loam,0.177,0.391,88.643,1.731,1.65,10.87,77.25,13.76,8.99,Sandy loam,19960619,2000012077,PRYO,Pryor,Adair,5,S,Mayes,36.36914,-95.27138,201,2,3,ENHANCED,0,0.14,0.467,8.341,1.513,1.4,0.03,20.73,68.18,11.09,Silt loam,0.089,0.453,17.717,1.269,1.4,0.71,26.43,60.88,12.69,Silt loam,-999,-999,-999,-999,1.45,0.04,16.72,43.81,39.41,Silty clay loam,-999,-999,-999,-999,1.35,0.04,14.31,32.41,53.28,Clay,19940101,2099123178,PUTN,Putnam,Putnam,3,N,Dewey,35.89904,-98.96038,589,2,4,ENHANCED,0,0.201,0.442,14.543,1.932,1.2,0.52,38.59,44.99,16.43,Loam,0.161,0.455,256.148,1.23,1.5,0,30.43,50.86,18.7,Silt loam,0.232,0.431,8.604,2.022,1.35,0,25.26,48.89,25.85,Loam,0.238,0.431,11.954,1.836,1.45,0,27.72,42.99,29.29,Clay loam,19940101,2099123179,REDR,Red Rock,Red Rock,7,SSE,Noble,36.3559,-97.15306,293,2,2,ENHANCED,0,0,0.525,770.016,1.109,1.45,6.21,35.36,46.03,18.61,Loam,0.197,0.452,120.224,1.165,1.25,0.98,25.34,34.04,40.62,Clay,0.193,0.411,38.766,1.15,1.35,0.68,17.95,32.5,49.55,Clay,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123180,RETR,Retrop,Willow,10,ENE,Washita,35.12275,-99.36001,538,2,4,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123181,RING,Ringling,Ringling,1,N,Jefferson,34.19365,-97.58812,283,2,8,ENHANCED,0,0.172,0.418,32.25,1.888,1.55,1.57,66.15,27.93,5.92,Sandy loam,0.201,0.455,115.926,1.341,1.4,0.45,48.56,27.3,24.14,Sandy clay loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123182,SALL,Sallisaw,Sallisaw,2,SSW,Sequoyah,35.43815,-94.79805,157,2,6,STANDARD,0,-999,-999,-999,-999,1.4,0.2,28.65,54.38,16.97,Silt loam,-999,-999,-999,-999,1.4,0.07,25.16,56.96,17.88,Silt loam,-999,-999,-999,-999,1.5,0.39,20.3,50.51,29.19,Clay loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123183,SEIL,Seiling,Seiling,7,WNW,Woodward,36.19033,-99.0403,545,2,2,ENHANCED,0,0.209,0.442,20.924,1.795,1.45,0,43.51,37.01,19.49,Loam,0.214,0.443,31.382,1.601,1.45,0.1,42.78,34.25,22.97,Loam,0.199,0.395,32.104,1.779,1.65,0.24,54.96,27.2,17.84,Sandy loam,0.199,0.394,31.228,1.71,1.65,0,52.02,29.74,18.24,Sandy loam,19940101,2099123184,SHAW,Shawnee,Shawnee,3,NNW,Pottawatomie,35.36492,-96.94822,328,2,5,ENHANCED,0,0.199,0.472,9.727,1.827,1.4,0,26.62,59.27,14.06,Silt loam,0.193,0.418,7.164,1.846,1.4,0,22.92,60.06,17.02,Silt loam,0.144,0.39,20.915,1.175,1.45,0,17.43,44.3,38.27,Silty clay loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123185,SKIA,Skiatook,Skiatook,4,NW,Osage,36.4153,-96.03706,282,2,3,STANDARD,0,0.153,0.66,346.353,1.417,0.54,0.3,72.04,22.89,5.06,Sandy loam,0.165,0.435,861.89,1.308,1.48,0.11,72.18,18.53,9.29,Sandy loam,0.207,0.395,47.771,1.787,1.65,0,62.56,18.35,19.09,Sandy loam,0.177,0.312,88.866,1.6,1.99,1.82,74.14,11.01,14.84,Sandy loam,19940101,2099123186,SLAP,Slapout,Slapout,8,W,Beaver,36.59749,-100.26192,774,2,1,STANDARD,0,0.171,0.407,322.69,1.758,1.6,1.27,89.98,4.21,5.8,Sand,0.172,0.419,803.637,1.203,1.55,1.95,57.33,27.88,14.79,Sandy loam,-999,-999,-999,-999,1.65,0,54.74,36.94,8.33,Sandy loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123187,SPEN,Spencer,Spencer,2,ENE,Oklahoma,35.54208,-97.34146,373,2,5,ENHANCED,0,0.18,0.416,100.928,1.736,1.55,3.23,78.14,12.3,9.56,Sandy loam,0.222,0.451,863.802,1.334,1.4,3.46,60.71,12.3,26.99,Sandy clay loam,-999,-999,-999,-999,1.5,0,53.65,23.06,23.29,Sandy clay loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123188,STIG,Stigler,Stigler,3,WNW,Haskell,35.26527,-95.18116,173,2,6,ENHANCED,0,0.165,0.455,7.831,1.857,1.4,0.11,25.56,68.92,5.53,Silt loam,0.173,0.455,8.199,1.836,1.4,1.04,24.73,67.63,7.64,Silt loam,0.164,0.431,8.621,1.638,1.5,0.12,23.48,64.51,12,Silt loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123189,STIL,Stillwater,Stillwater,2,W,Payne,36.12093,-97.09527,272,2,5,STANDARD,0,0,0.56,28.148,1.132,0.96,0,19.38,48.2,32.42,Silty clay loam,0.217,0.456,19.104,1.636,1.39,0,36.45,41.64,21.91,Loam,0.235,0.451,14.885,1.787,1.41,0,33.26,41.31,25.43,Loam,0.234,0.435,11.296,1.894,1.48,0,32.49,40.5,27,Clay loam,19940101,2099123190,STUA,Stuart,Stuart,3,SE,Pittsburg,34.87642,-96.06982,256,2,6,ENHANCED,0,0.16,0.407,106.945,1.646,1.38,1.58,81.95,15.51,2.53,Loamy sand,0.166,0.417,104.341,1.572,1.61,2.53,74.72,20.53,4.75,Sandy loam,0.165,0.377,254.532,1.53,1.61,8.3,83.65,11.43,4.93,Loamy sand,0.185,0.393,332.329,1.476,1.61,4.3,74.64,12.4,12.96,Sandy loam,19940101,2099123191,SULP,Sulphur,Sulphur,4,NNE,Murray,34.5661,-96.95048,320,2,8,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123192,TAHL,Tahlequah,Tahlequah,4,N,Cherokee,35.97235,-94.98671,290,2,6,ENHANCED,0,0.163,0.436,8.516,1.862,1.4,14.14,23.67,69,7.33,Silt loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123193,TALI,Talihina,Talihina,4,SE,LeFlore,34.7107,-95.01152,204,2,9,ENHANCED,0,0.164,0.491,67.008,1.098,1.55,1.13,51.85,42.14,6.01,Sandy loam,0.154,0.49,59.135,1.097,1.25,0.66,17.85,38.04,44.11,Clay,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123194,TIPT,Tipton,Tipton,4,S,Tillman,34.43972,-99.13755,387,2,7,ENHANCED,0,0.195,0.418,25.562,1.878,1.55,0.01,52.64,33.49,13.87,Sandy loam,0.194,0.418,25.217,1.888,1.45,0,51.44,35.64,12.91,Loam,0.199,0.394,36.384,1.747,1.65,0,52.24,30.07,17.69,Sandy loam,0.186,0.395,1675.771,1.279,1.65,0.01,56.07,25.75,18.19,Sandy loam,19940101,2099123195,TISH,Tishomingo,Tishomingo,6,N,Johnston,34.33262,-96.67895,268,2,8,ENHANCED,0,0.127,0.455,18.808,1.408,1.4,3.06,34.62,55.43,9.95,Silt loam,0.143,0.455,20.443,1.346,1.4,2.06,29.45,53.04,17.5,Silt loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123196,TULL,Tullahassee,Tullahassee,2,ENE,Wagoner,35.8397,-95.4133,189,2,3,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,19991104115,VANO,Vanoss,Vanoss,2.4,NE,Pontotoc,34.79146,-96.84381,320,2,8,STANDARD,0,0.198,0.418,30.494,1.808,1.55,1.87,52.87,32.3,14.82,Sandy loam,0.183,0.443,636.554,1.212,1.45,0.26,43.39,32.73,23.98,Loam,0.261,0.467,92.159,1.25,1.35,0.03,26.94,27.57,45.49,Clay,0.217,0.466,1350.125,1.136,1.35,0.84,30.66,26.78,42.56,Clay,19980617,2099123197,VINI,Vinita,Centralia,7,E,Craig,36.77536,-95.22094,236,2,3,ENHANCED,0,0.184,0.495,12.981,1.668,1.4,2.09,29.48,59.09,11.43,Silt loam,0.149,0.459,27.453,1.347,1.4,5.28,31.08,53.38,15.54,Silt loam,0.191,0.435,20.909,1.29,1.5,2.48,20.6,46.31,33.1,Clay loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,2099123198,WALT,Walters,Walters,1,NW,Cotton,34.3647,-98.32025,308,2,7,STANDARD,0,0.221,0.455,6.26,2.244,1.4,0,22.26,61.36,16.38,Silty loam,0.205,0.491,54.623,1.184,1.35,0,18.09,38.31,43.6,Clay,0.183,0.467,121.985,1.15,1.5,0.19,20.44,38.72,40.85,Clay,0.201,0.43,41.815,1.25,1.5,2.92,23.11,39.25,37.63,Clay loam,19940101,2099123199,WASH,Washington,Washington,6,SSW,McClain,34.98224,-97.52109,345,2,5,SUPER,0,0.189,0.443,31.385,1.624,1.45,0,51.65,35.11,13.23,Loam,0.23,0.454,36.432,1.764,1.35,0,51.35,25.04,23.61,Sandy clay loam,0.196,0.395,36.608,1.729,1.65,0,54.85,26.64,18.51,Sandy loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,20991231100,WATO,Watonga,Watonga,7,W,Blaine,35.84185,-98.52615,517,2,4,STANDARD,0,0.195,0.443,18.797,1.802,1.45,0,45.29,41.32,13.39,Loam,0.213,0.443,14.489,1.86,1.45,0,39.13,41.59,19.28,Loam,0.141,0.419,37.727,1.231,1.55,0,33.22,41.9,24.88,Loam,0.147,0.419,68.541,1.208,1.55,0,38.33,35.33,26.34,Loam,19940101,20991231101,WAUR,Waurika,Waurika,0.5,ENE,Jefferson,34.16775,-97.98815,283,2,8,ENHANCED,0,0.184,0.419,81.654,1.712,1.55,0,72.32,17.81,9.87,Sandy loam,0.194,0.419,107.525,1.617,1.55,0,70.36,14.65,14.99,Sandy loam,0.195,0.395,83.3,1.641,1.65,0,67.07,16.2,16.73,Sandy loam,0.191,0.395,89.635,1.605,1.65,0,68.62,16.22,15.16,Sandy loam,19940101,20991231102,WEAT,Weatherford,Weatherford,4,WSW,Custer,35.5083,-98.77509,538,2,4,STANDARD,0,0.176,0.446,14.607,1.867,1.4,7.73,34.59,55.63,9.78,Silt loam,0.183,0.438,18.742,1.74,1.45,0,37.02,49.63,13.35,Loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,20991231103,WEBB,Webbers Falls,Webbers Falls,3,S,Muskogee,35.47298,-95.13209,145,2,6,STANDARD,0,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,20080416132,WEBR,Webbers Falls,Webbers Falls,1.5,S,Muskogee,35.489,-95.1233,145,2,6,STANDARD,,-999,-999,-999,-999,-999,-999,23.55,60.57,15.88,Silt Loam,-999,-999,-999,-999,-999,-999,21.73,61.38,16.89,Silt Loam,-999,-999,-999,-999,-999,-999,19.64,57.57,22.79,Silt Loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,20080417,20991231104,WEST,Westville,Westville,5,WNW,Adair,36.011,-94.64496,348,2,6,ENHANCED,0,0,0.449,53.026,1.158,1.4,11.47,32.51,56.53,10.96,Silt loam,0.16,0.462,13.238,1.269,1.35,8.78,13.64,53.92,32.44,Silty clay loam,0.052,0.429,39.546,1.152,1.5,6.85,28.48,48.62,22.89,Loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,Rock,19940101,20991231105,WILB,Wilburton,Wilburton,2,SW,Latimer,34.90092,-95.34805,199,2,9,ENHANCED,0,0.105,0.453,22.208,1.297,1.4,5.53,29.57,58.87,11.57,Silt loam,0.138,0.45,25.27,1.358,1.4,9.67,31.61,58.22,10.17,Silt loam,-999,-999,-999,-999,1.35,14.27,18.03,29.04,52.93,Clay,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,20991231106,WIST,Wister,Wister,3,ENE,LeFlore,34.98426,-94.68778,143,2,9,ENHANCED,0,0.193,0.454,10.206,1.591,1.4,6.72,21.03,61.59,17.38,Silt loam,0.198,0.454,10.593,1.544,1.4,3.02,22.2,57.07,20.73,Silt loam,0.232,0.424,8.604,2.022,1.5,13.61,19.09,57.51,23.39,Silt loam,0.127,0.454,26.026,1.147,1.4,3.55,15.87,41.5,42.64,Silty clay,19940101,20991231107,WOOD,Woodward,Woodward,2,WSW,Woodward,36.42329,-99.41682,625,2,2,ENHANCED,0,0.194,0.419,27.379,1.907,1.55,0.26,53.62,33.72,12.66,Sandy loam,0.203,0.443,33.506,1.751,1.45,0.26,47.58,35.1,17.32,Loam,0.142,0.419,1016.867,1.185,1.55,0.27,48.38,37.5,14.12,Loam,0.145,0.419,1310.176,1.185,1.55,0.27,51.57,33.79,14.64,Loam,19940101,20991231108,WYNO,Wynona,Wynona,2,S,Osage,36.51806,-96.34222,269,2,3,ENHANCED,0,0.178,0.419,19.283,1.385,1.4,0.25,25.71,52.98,21.31,Silt loam,0.23,0.439,11.954,1.643,1.4,2.72,25.44,46.05,28.51,Clay loam,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,-999,19940101,20991231
'''

#Map of standard variable names to those use by the mesonet
mesonet_var_map = {'temperature':'TAIR', 'relative humidity':'RELH',
    'wind speed':'WSPD', 'wind direction':'WDIR', 'rainfall':'RAIN',
    'pressure':'PRES', 'site':'STID', 'solar radiation':'SRAD',
    'wind gusts':'WMAX'}
mesonet_inv_var_map = dict(zip(mesonet_var_map.values(),
    mesonet_var_map.keys()))

mesonet_units = {'TAIR':'C', 'RELH':'%', 'PRES':'mb', 'WSPD':'m/s',
    'SRAD':'W/m^2', 'RAIN':'mm', 'WDIR':'deg', 'WMAX':'m/s'}

#Some special numbers
BAD_DATA_LIMIT = -990
FUTURE_OBSERVATION = -996

@lru_cache(maxsize=20)
def _fetch_mesonet_data(date_time, site=None):
    '''
    Helper function for fetching mesonet data from a remote location.
    Uses an LRU cache.
    '''
    if site is None:
        data_type = 'mdf'
        #Put time back to last even 5 minutes
        date_time = date_time.replace(minute=(date_time.minute
            - date_time.minute%5), second=0, microsecond=0)
        fname = '%s.mdf' % date_time.strftime('%Y%m%d%H%M')
    else:
        data_type = 'mts'
        fname = '%s%s.mts' % (date_time.strftime('%Y%m%d'), site.lower())

    #Create the various parts of the URL and assemble them together
    path = '/%s/%04d/%02d/%02d/' % (data_type, date_time.year, date_time.month,
        date_time.day)
    baseurl='http://www.mesonet.org/public/data/getfile.php?dir=%s&filename=%s'

    #Open the remote location
    datafile = urlopen(baseurl % (path+fname, fname))

    return datafile.read()

def remote_mesonet_data(date_time=None, fields=None, site=None,
    convert_time=True, lookup_stids=True, full_day_record=True):
    '''
    Reads in Oklahoma Mesonet Datafile (MDF) directly from their servers.

    date_time : datetime object
        A python :class:`datetime` object specify that date and time
        for which that data should be downloaded.  For a times series
        data, this only needs to be a date.  For snapshot files, this is
        the time to the nearest five minutes.

    fields : sequence
        A list of the variables which should be returned.  See
        :func:`read_mesonet_data` for a list of valid fields.

    site : string
        Optional station id for the data to be fetched.  This is
        case-insensitive.  If specified, a time series file will be
        downloaded.  If left blank, a snapshot data file for the whole
        network is downloaded.

    convert_time : boolean
        Flag indicating whether the time reported in the file, which is
        in minutes since midnight of the files date, should be converted
        to a datetime.datetime object using the date reported at the top
        of the file. Defaults to True.

    lookup_stids : boolean
        Flag indicating whether to lookup the location for the station id
        and include this information in the returned data. Defaults to True.

    full_day_record : boolean
        Flag indicating whether to get yesterday's data as well as today's,
        when datetime is None.  This will give a full 24 hour of data, as
        opposed to just today's (incomplete) set.

    Returns : array
        A nfield by ntime masked array.  nfield is the number of fields
        requested and ntime is the number of times in the file.  Each
        variable is a row in the array.  The variables are returned in
        the order given in *fields*.
    '''
    #If we don't get a date, and therefore are using today, fetch yesterday's
    #data too so that we can have a full 24 hour record, only if we are using
    #time series and not a mesonet data file
    yest = None
    if date_time is None:
        import datetime
        date_time = datetime.datetime.utcnow()
        if site is None:
            # Take off time to allow for lag of 'current data' behind actual
            # time
            date_time -= datetime.timedelta(minutes=10)
        elif full_day_record:
            yest = date_time - datetime.timedelta(days=1)

            old_data = StringIO(_fetch_mesonet_data(yest, site))
            old_data = read_mesonet_data(old_data, fields, convert_time,
                lookup_stids)

    #Fetch the data and read it in
    data = StringIO(_fetch_mesonet_data(date_time, site))
    data = read_mesonet_data(data, fields, convert_time, lookup_stids)

    if yest:
        # Need to create a new array.  Resizing the old ones will not work.
        final_data = np.ma.empty(old_data.size + data.size, dtype=data.dtype)
        final_data[:old_data.size] = old_data
        final_data[old_data.size:] = data
        data = final_data

    return data

def read_mesonet_data(filename, fields=None, convert_time=True,
    lookup_stids=True):
    '''
    Reads Oklahoma Mesonet data from *filename*.

    filename : string or file-like object
        Location of data. Can be anything compatible with
        :func:`numpy.loadtxt`, including a filename or a file-like
        object.

    fields : sequence
        List of fields to read from file.  (Case insensitive)
        Valid fields are:
            STID, STNM, TIME, RELH, TAIR, WSPD, WVEC, WDIR, WDSD,
            WSSD, WMAX, RAIN, PRES, SRAD, TA9M, WS2M, TS10, TB10,
            TS05, TB05, TS30, TR05, TR25, TR60, TR75
        The default is to return all fields.

    convert_time : boolean
        Flag indicating whether the time reported in the file, which is
        in minutes since midnight of the files date, should be converted
        to a datetime.datetime object using the date reported at the top
        of the file. Defaults to True.

    lookup_stids : boolean
        Flag indicating whether to lookup the location for the station id
        and include this information in the returned data. Defaults to True.

    Returns : array
        A nfield by ntime masked array.  nfield is the number of fields
        requested and ntime is the number of times in the file.  Each
        variable is a row in the array.  The variables are returned in
        the order given in *fields*.
    '''
    from datetime import datetime, timedelta

    if is_string_like(filename):
        if filename.endswith('.gz'):
            import gzip
            fh = gzip.open(filename)
        elif filename.endswith('.bz2'):
            import bz2
            fh = bz2.BZ2File(filename)
        else:
            fh = file(filename)
    elif hasattr(filename, 'readline'):
        fh = filename
    else:
        raise ValueError('filename must be a string or file handle')

    if fields:
        fields = map(str.upper, fields)

    #If we're converting the time, we need to read the 2nd line of the file
    #and parse that into a date object.  We use this object with a timedelta
    #to make a custom converter.  We also need to then tell the reader to no
    #longer skip any rows.
    if convert_time:
        #Skip first line, read the second for the date
        fh.readline()
        info = fh.readline().split()
        dt = datetime(*map(int, info[1:4]))
        skip = 0
        conv = {'TIME': lambda t: dt + timedelta(minutes=int(t))}
    else:
        skip = 2
        conv = None

    # This long list is needed because missing values are detected by
    # string equality and not value, so that -999 is not the same
    # as -999.00
    missing_vals = range(BAD_DATA_LIMIT, BAD_DATA_LIMIT-10, -1)
    missing_strs = (map(str, missing_vals)
        + ['%.0f' % v for v in missing_vals]
        + ['%.1f' % v for v in missing_vals]
        + ['%.2f' % v for v in missing_vals])
    missing = ','.join(missing_strs)
    data = mloadtxt(fh, dtype=None, names=True, usecols=fields, skiprows=skip,
        converters=conv, missing=missing)

    #Use the inverted dictionary to map names in the FILE to their more
    #descriptive counterparts
    data = add_dtype_titles(data, mesonet_inv_var_map)

    #Change converted column name from TIME to datetime
    if convert_time and (fields is None or 'TIME' in fields):
        names = list(data.dtype.names)
        names[names.index('TIME')] = 'datetime'
        data.dtype.names = names
        data.mask.dtype.names = names

    #Lookup station information so that returned data has latitude and
    #longitude information
    if lookup_stids and (fields is None or 'STID' in fields):
        sta_table = mesonet_stid_info()
        station_indices = sta_table['stid'].searchsorted(data['STID'])
        lat = sta_table['Lat'][station_indices]
        lon = sta_table['Lon'][station_indices]
        elev = sta_table['Elev'][station_indices]
        data = rec_append_fields(data, ('latitude', 'longitude', 'elevation'),
            (lat, lon, elev))

    return data

def mesonet_stid_info(info=None, remote=False):
    '''
    Get mesonet station information.

    info : sequence of tuples
        Sequence of column name and number pairs, specifying
        what information to return.  The default of None returns
        station ID, latitude, longitude, and elevation.

    remote : boolean
        Flag indicating whether to read the station table information
        from the Oklahoma Mesonet's website (True) or to use a local copy
        (False).  Defaults to False.

    Returns : structured array
        A structured array with the station information.
    '''
    if info is None:
        names = ['stid', 'Lat', 'Lon', 'Elev']
        cols = (1, 7, 8, 9)
    else:
        names,cols = zip(*info)

    if remote:
        station_info = urlopen('http://www.mesonet.org/sites/geomeso.csv')
    else:
        station_info = StringIO(mesonet_station_table)

    return loadtxt(station_info, dtype=None, skiprows=123, usecols=cols,
        names=names, delimiter=',')

def get_last_time(data, ref_field='TAIR', dt_field='datetime'):
    '''
    Get the time of the last actual observation in a mesonet file.

    data : structured array
        The mesonet data

    ref_field : string
        The name of the field in which to look to find where future
        observations are marked.  This defaults to 'TAIR'.

    dt_field : string
        The name of the field containing date/time information. Defaults
        to 'datetime'.

    Returns : the date/time of the last actual observation in the file
    '''
    mask = data[ref_field].data != FUTURE_OBSERVATION
    return data[dt_field][mask][-1]

if __name__ == '__main__':
    import datetime, os, os.path
    from optparse import OptionParser

    import scipy.constants as sconsts
    import matplotlib.pyplot as plt
    from mpl_toolkits.basemap import Basemap
    from metpy.vis import meteogram, station_plot
    from metpy.constants import C2F
    from metpy.calc import dewpoint, windchill, get_wind_components

    #Create a command line option parser so we can pass in site and/or date
    parser = OptionParser()
    parser.add_option('-s', '--site', dest='site', help='Get data for SITE. '
        'SITE can be "None" to specify a mesonet data file for all stations '
        'instead of using a time series file for a single station.',
        metavar='SITE', default='nrmn')
    parser.add_option('-d', '--date', dest='date', help='get data for '
        'YYYYMMDD[_HHMM] (HHMM is only used with None for site)',
        metavar='YYYYMMDD', default=None)

    #Parse the command line options and convert them to useful values
    opts,args = parser.parse_args()
    if opts.site == 'None':
        opts.site = None
    if opts.date is not None:
        if opts.site is None:
            dt = datetime.datetime.strptime(opts.date, '%Y%m%d_%H%M')
        else:
            dt = datetime.datetime.strptime(opts.date, '%Y%m%d')
    else:
        dt = None

    fields = ('stid', 'time', 'relh', 'tair', 'wspd', 'wmax', 'wdir', 'pres',
        'srad', 'rain')

    data = remote_mesonet_data(dt, fields, opts.site)

    #Add a reasonable time range if we're doing current data
    if dt is None:
        end = get_last_time(data)
        times = (end - datetime.timedelta(hours=24), end)
    else:
        times = None

    #Calculate dewpoint in F from relative humidity and temperature
    dewpt = C2F(dewpoint(data['TAIR'], data['RELH']/100.))
    data = rec_append_fields(data, ('dewpoint',), (dewpt,))

    #Convert temperature and dewpoint to Farenheit
    mod_units = mesonet_units.copy()
    mod_units['TAIR'] = 'F'
    mod_units['dewpoint'] = 'F'
    data['TAIR'] = C2F(data['TAIR'])

    #Convert wind speeds to MPH
    data['WSPD'] *= sconsts.hour / sconsts.mile
    data['WMAX'] *= sconsts.hour / sconsts.mile
    mod_units['WSPD'] = 'MPH'
    mod_units['WMAX'] = 'MPH'

    #Convert rainfall to inches
    data['RAIN'] *= sconsts.milli / sconsts.inch
    mod_units['RAIN'] = 'in.'

    #Calculate windchill
    wchill = windchill(data['TAIR'], data['WSPD'], metric=False)
    data = rec_append_fields(data, ('windchill',), (wchill,))

    #If site is None, do a station plot, otherwise do a meteogram
    if opts.site is None:
        # Convert wind speed and direction to U,V components
        u,v = get_wind_components(data['WSPD'], data['WDIR'])
        data = rec_append_fields(data, ('u', 'v'), (u, v))

        #Mask 0 rainfall
        rain = data['rainfall']
        rain[rain == 0.0] = ma.masked

        fig = plt.figure(figsize=(20,12))
        ax = fig.add_subplot(1,1,1)
        m = Basemap(lon_0=-99, lat_0=35, lat_ts=35, resolution='i',
            projection='stere', urcrnrlat=37., urcrnrlon=-94.25, llcrnrlat=33.7,
            llcrnrlon=-103., ax=ax)
        m.bluemarble()
        station_plot(data, ax=ax, proj=m, field_info=mesonet_var_map,
            styles=dict(dewpoint=dict(color='lightgreen'),
                        rainfall=dict(color='darkblue')),
            layout=dict(E='rainfall'), formats=dict(RAIN='%.1f'), offset=11)
        m.drawstates(ax=ax, zorder=0)

        #Optionally plot a counties shapefile
        mapfile = os.path.join(os.environ['HOME'], 'mapdata', 'c_03oc08.shp')
        if os.path.exists(mapfile):
            m.readshapefile(mapfile, 'counties', zorder=0)

        plt.title(data['datetime'][0].strftime('%H%MZ %d %b %Y'))
    else:
        fig = plt.figure(figsize=(8,10))
        layout = {0:['TAIR', 'dewpoint', 'windchill']}
        axs = meteogram(data, fig, num_panels=5, field_info=mesonet_var_map,
            units=mod_units, time_range=times, layout=layout)
        axs[0].set_ylabel('Temperature (F)')

    plt.show()
